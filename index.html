<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>valentine?</title>
<link rel="icon" type="image/png" href="favicon.png">

<style>
body {
    margin: 0;
    overflow: hidden;
    background-color: #de9df3;
}

.scene {
    position: relative;
    width: 100vw;
    height: 100vh;
}

.moving-squares {
    position: absolute;
    width: 200%;
    height: 100%;
    background: url("squares.png") repeat;
    animation: moveSquares 60s linear infinite;
    z-index: 1;
}

@keyframes moveSquares {
    from { transform: translateX(0); }
    to { transform: translateX(-50%); }
}

.card {
    position: relative; /* important for responsive yes/no */
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background-color: #ebc5f8;
    z-index: 2;
    width: calc(100vh * 4 / 3);
    height: 100vh;
    max-width: 100vw;
    max-height: calc(100vw * 3 / 4);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: space-between;
    padding: 2%;
    box-sizing: border-box;
}

.sign {
    width: 135%;      /* bigger than card width */
    max-width: none;  /* no cap */
    height: auto;     /* keep aspect ratio */
    position: relative;
    top: -5%;         /* move down/up */
    pointer-events: none;
}

/* responsive yes/no image display */
#choice-display {
    position: absolute;
    top: 48%;       /* % of card height */
    width: 5%;      /* % of card width */
    height: auto;
    pointer-events: none;
    z-index: 6;
}

#choice-display[src="yes.png"] {
    left: 38%;      /* relative to card */
    right: auto;
}

#choice-display[src="no.png"] {
    right: 46%;     /* relative to card */
    left: auto;
}

.continue-btn {
    position: absolute;
    bottom: 16%;
    left: 50%;
    transform: translateX(-50%);
    width: 150%;
    max-width: none;
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 4;
    background: none;
    border: none;
    cursor: pointer;
}

.continue-btn img {
    width: 30%;
    height: auto;
    display: block;
}

.continue-btn .hover {
    display: none;
}

.continue-btn:hover .default {
    display: none;
}

.continue-btn:hover .hover {
    display: block;
}

.clowns {
    position: absolute;
    bottom: 0;
    left: 50%;
    transform: translateX(-50%);
    width: 100%;
    max-width: none;
    height: auto;
    z-index: 5;
    pointer-events: none;
}

#confetti-canvas {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    pointer-events: none;
    z-index: 10;
}

#music-toggle {
    position: fixed;
    top: 50px;
    left: 50px;
    width: 100px;
    height: auto;
    z-index: 2;
    cursor: pointer;
    user-select: none;
}

/* invisible yes/no buttons overlay */
.choice-btn {
    position: absolute;
    z-index: 7; 
    background: none;
    border: none;
    cursor: pointer;
}
#yes-btn {
    top: 43%; 
    left: 39%;
    width: 10%;
    height: 10%;
}
#no-btn {
    top: 43%;
    right: 44%;
    width: 10%;
    height: 10%;
}
</style>
</head>
<body>

<div class="scene">

    <div class="moving-squares"></div>

    <div class="card">
        <img src="sign.png" class="sign">

        <img id="choice-display" src="">

        <button id="yes-btn" class="choice-btn"></button>
        <button id="no-btn" class="choice-btn"></button>

        <button class="continue-btn" id="continue-btn">
            <img src="continue.png" class="default">
            <img src="continue2.png" class="hover">
        </button>
    </div>

    <img src="clowns.png" class="clowns">

</div>

<canvas id="confetti-canvas"></canvas>

<audio id="yippie-sound" src="yippie.mp3"></audio>
<audio id="ohno-sound" src="ohno.mp3"></audio>
<audio id="pen-sound" src="pen.mp3"></audio>
<audio id="undead-sound" src="undead.mp3" loop></audio>

<img id="music-toggle" src="nomusic.png" alt="Music Toggle">

<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
<script>
const confettiCanvas = document.getElementById('confetti-canvas');
const continueBtn = document.getElementById('continue-btn');
const yippie = document.getElementById('yippie-sound');
const ohno = document.getElementById('ohno-sound');
const pen = document.getElementById('pen-sound');
const undead = document.getElementById('undead-sound');
const musicToggle = document.getElementById('music-toggle');
const yesBtn = document.getElementById('yes-btn');
const noBtn = document.getElementById('no-btn');
const choiceDisplay = document.getElementById('choice-display');
const scene = document.querySelector('.scene');

undead.volume = 0.3;

const myConfetti = confetti.create(confettiCanvas, { resize: true, useWorker: true });

let musicPlaying = false;
musicToggle.addEventListener('click', () => {
    if (musicPlaying) {
        undead.pause();
        musicToggle.src = 'nomusic.png';
        musicPlaying = false;
    } else {
        undead.play().catch(e=>console.log('autoplay blocked', e));
        musicToggle.src = 'yesmusic.png';
        musicPlaying = true;
    }
});

let selected = null;

yesBtn.addEventListener('click', () => {
    pen.currentTime = 0;
    pen.play();
    selected = "yes";
    choiceDisplay.src = "yes.png";
});

noBtn.addEventListener('click', () => {
    pen.currentTime = 0;
    pen.play();
    selected = "no";
    choiceDisplay.src = "no.png";
});

continueBtn.addEventListener('click', () => {
    if(selected === "yes") {
        yippie.currentTime = 0;
        yippie.play();
        myConfetti({
            particleCount: 300,
            spread: 120,
            origin: { y: 0.5 }
        });
    } else if(selected === "no") {
        ohno.currentTime = 0;
        ohno.play();

        // desaturate for 10s
        scene.style.transition = 'filter 1s ease';
        scene.style.filter = 'saturate(5%)';
        setTimeout(() => {
            scene.style.filter = 'saturate(100%)';
        }, 10000);
    }
});

// dvd bouncing toggle
let posX = 50, posY = 50, speedX = 14, speedY = 10;
function moveDVD() {
    const vw = window.innerWidth, vh = window.innerHeight;
    const width = musicToggle.offsetWidth, height = musicToggle.offsetHeight;
    posX += speedX; posY += speedY;
    if(posX + width >= vw || posX <= 0) speedX = -speedX;
    if(posY + height >= vh || posY <= 0) speedY = -speedY;
    musicToggle.style.left = posX + 'px';
    musicToggle.style.top = posY + 'px';
    requestAnimationFrame(moveDVD);
}
moveDVD();
</script>

</body>
</html>
